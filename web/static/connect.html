<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connection Settings - DroneBridge</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent-blue: #3b82f6;
            --accent-green: #22c55e;
            --accent-red: #ef4444;
            --accent-yellow: #eab308;
            --accent-purple: #8b5cf6;
            --accent-cyan: #06b6d4;
            --border: #334155;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #0c1222 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .back-btn {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }

        .back-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--accent-blue);
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .status-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .status-card {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .status-card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .status-icon {
            font-size: 2rem;
        }

        .status-card-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .status-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .status-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .signal-bars {
            display: flex;
            gap: 0.25rem;
            align-items: flex-end;
            height: 30px;
        }

        .signal-bar {
            width: 8px;
            background: var(--border);
            border-radius: 2px;
            transition: background 0.3s ease;
        }

        .signal-bar.active {
            background: var(--accent-green);
        }

        .signal-bar:nth-child(1) { height: 30%; }
        .signal-bar:nth-child(2) { height: 50%; }
        .signal-bar:nth-child(3) { height: 70%; }
        .signal-bar:nth-child(4) { height: 90%; }
        .signal-bar:nth-child(5) { height: 100%; }

        .setting-section {
            background: var(--bg-card);
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid var(--border);
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-icon {
            font-size: 2rem;
        }

        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem;
            background: var(--bg-primary);
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            transition: all 0.2s ease;
        }

        .setting-row:hover {
            background: var(--bg-secondary);
        }

        .setting-info {
            flex: 1;
        }

        .setting-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .setting-desc {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: var(--bg-secondary);
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s ease;
            border: 1px solid var(--border);
        }

        .toggle-switch.active {
            background: var(--accent-green);
            border-color: var(--accent-green);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active::after {
            transform: translateX(30px);
        }

        .priority-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .priority-option {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .priority-option:hover {
            border-color: var(--accent-blue);
            background: var(--bg-secondary);
        }

        .priority-option.active {
            border-color: var(--accent-green);
            background: rgba(34, 197, 94, 0.1);
        }

        .priority-option-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .priority-option-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .priority-option-desc {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
        }

        .btn-primary {
            background: var(--accent-blue);
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: #334155;
            border-color: var(--accent-blue);
        }

        .connection-log {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1rem;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            color: var(--accent-green);
            margin-top: 1rem;
        }

        .log-entry {
            margin-bottom: 0.5rem;
            padding: 0.25rem 0;
        }

        .log-timestamp {
            color: var(--text-secondary);
            margin-right: 0.5rem;
        }

        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: var(--bg-card);
            border: 1px solid var(--accent-green);
            border-radius: 0.75rem;
            padding: 1rem 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: none;
            align-items: center;
            gap: 0.75rem;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification.show {
            display: flex;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="dashboard.html" class="back-btn">
                ‚Üê Quay l·∫°i
            </a>
            <h1>üì° Connection Settings</h1>
        </div>

        <!-- Status Overview -->
        <div class="status-overview">
            <div class="status-card">
                <div class="status-card-header">
                    <span class="status-icon">üåê</span>
                    <span class="status-card-title">Server Connection</span>
                </div>
                <div class="status-value" id="serverSignal" style="color: var(--accent-green);">‚óè</div>
                <div class="status-label" id="serverStatus">Connected - 45ms latency</div>
            </div>

            <div class="status-card">
                <div class="status-card-header">
                    <span class="status-icon">üì∂</span>
                    <span class="status-card-title">WiFi Strength</span>
                </div>
                <div class="signal-bars" id="wifiSignal">
                    <div class="signal-bar active"></div>
                    <div class="signal-bar active"></div>
                    <div class="signal-bar active"></div>
                    <div class="signal-bar active"></div>
                    <div class="signal-bar"></div>
                </div>
                <div class="status-label" id="wifiSpeed">Speed: 54 Mbps</div>
            </div>

            <div class="status-card">
                <div class="status-card-header">
                    <span class="status-icon">üì°</span>
                    <span class="status-card-title">4G Signal</span>
                </div>
                <div class="signal-bars" id="fourGSignal">
                    <div class="signal-bar active"></div>
                    <div class="signal-bar active"></div>
                    <div class="signal-bar active"></div>
                    <div class="signal-bar"></div>
                    <div class="signal-bar"></div>
                </div>
                <div class="status-label" id="fourGSpeed">Speed: 12 Mbps</div>
            </div>

            <div class="status-card">
                <div class="status-card-header">
                    <span class="status-icon">üîÑ</span>
                    <span class="status-card-title">Active Connection</span>
                </div>
                <div class="status-value" id="activeConnection" style="color: var(--accent-blue); font-size: 1.5rem;">WiFi</div>
                <div class="status-label">Auto-switching enabled</div>
            </div>

            <div class="status-card">
                <div class="status-card-header">
                    <span class="status-icon">üì±</span>
                    <span class="status-card-title">Current Network</span>
                </div>
                <div class="status-value" id="currentCarrier" style="color: var(--accent-cyan); font-size: 1.3rem;">Loading...</div>
                <div class="status-label" id="carrierDetails">Detecting network...</div>
            </div>
        </div>

        <!-- Priority Settings -->
        <div class="setting-section">
            <div class="section-title">
                <span class="section-icon">‚ö°</span>
                Connection Priority
            </div>

            <div class="priority-selector">
                <div class="priority-option active" id="priority-wifi" onclick="setPriority('wifi')">
                    <div class="priority-option-icon">üì∂</div>
                    <div class="priority-option-name">WiFi Priority</div>
                    <div class="priority-option-desc">∆Øu ti√™n WiFi n·∫øu kh·∫£ d·ª•ng, t·ªëc ƒë·ªô cao h∆°n</div>
                </div>

                <div class="priority-option" id="priority-4g" onclick="setPriority('4g')">
                    <div class="priority-option-icon">üì°</div>
                    <div class="priority-option-name">4G Priority</div>
                    <div class="priority-option-desc">∆Øu ti√™n 4G, ƒë·ªô tin c·∫≠y cao, ph·∫°m vi r·ªông</div>
                </div>
            </div>
        </div>

        <!-- Advanced Settings -->
        <div class="setting-section">
            <div class="section-title">
                <span class="section-icon">‚öôÔ∏è</span>
                Advanced Settings
            </div>

            <div class="setting-row">
                <div class="setting-info">
                    <div class="setting-name">Auto-switching</div>
                    <div class="setting-desc">T·ª± ƒë·ªông chuy·ªÉn ƒë·ªïi gi·ªØa WiFi v√† 4G khi c·∫ßn thi·∫øt</div>
                </div>
                <div class="toggle-switch active" id="autoSwitch" onclick="toggleAutoSwitch()"></div>
            </div>

            <div class="setting-row">
                <div class="setting-info">
                    <div class="setting-name">Reconnect on failure</div>
                    <div class="setting-desc">T·ª± ƒë·ªông k·∫øt n·ªëi l·∫°i khi m·∫•t k·∫øt n·ªëi</div>
                </div>
                <div class="toggle-switch active" id="autoReconnect" onclick="toggleAutoReconnect()"></div>
            </div>

            <div class="setting-row">
                <div class="setting-info">
                    <div class="setting-name">WiFi signal threshold</div>
                    <div class="setting-desc">Ng∆∞·ª°ng t√≠n hi·ªáu WiFi t·ªëi thi·ªÉu ƒë·ªÉ duy tr√¨ k·∫øt n·ªëi (-70 dBm)</div>
                </div>
                <select class="btn btn-secondary" id="wifiThreshold" onchange="saveSettings()">
                    <option value="-60">Strong (-60 dBm)</option>
                    <option value="-70" selected>Good (-70 dBm)</option>
                    <option value="-80">Fair (-80 dBm)</option>
                    <option value="-90">Weak (-90 dBm)</option>
                </select>
            </div>

            <div class="setting-row">
                <div class="setting-info">
                    <div class="setting-name">Connection timeout</div>
                    <div class="setting-desc">Th·ªùi gian timeout khi m·∫•t k·∫øt n·ªëi (gi√¢y)</div>
                </div>
                <select class="btn btn-secondary" id="timeout" onchange="saveSettings()">
                    <option value="5">5 seconds</option>
                    <option value="10" selected>10 seconds</option>
                    <option value="15">15 seconds</option>
                    <option value="30">30 seconds</option>
                </select>
            </div>

            <div class="setting-row">
                <div class="setting-info">
                    <div class="setting-name">4G Network Mode</div>
                    <div class="setting-desc">Ch·ªçn bƒÉng t·∫ßn cho module 4G (Auto: t·ª± ƒë·ªông 2G/3G/4G)</div>
                </div>
                <select class="btn btn-secondary" id="fourGMode" onchange="set4GMode()">
                    <option value="auto" selected>Auto (2G/3G/4G)</option>
                    <option value="4G">4G Only</option>
                    <option value="3G">3G Only</option>
                    <option value="2G">2G Only</option>
                </select>
            </div>

            <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
                <button class="btn btn-primary" onclick="saveSettings()">üíæ Save Settings</button>
                <button class="btn btn-secondary" onclick="testConnection()">üîç Test Connection</button>
            </div>
        </div>

        <!-- Connection Log -->
        <div class="setting-section">
            <div class="section-title">
                <span class="section-icon">üìã</span>
                Connection Log
            </div>
            <div class="connection-log" id="connectionLog">
                <div class="log-entry">
                    <span class="log-timestamp">[12:34:56]</span>
                    <span>WiFi connected - Signal: -65 dBm</span>
                </div>
                <div class="log-entry">
                    <span class="log-timestamp">[12:34:45]</span>
                    <span>Server connection established - Latency: 45ms</span>
                </div>
                <div class="log-entry">
                    <span class="log-timestamp">[12:34:30]</span>
                    <span>4G module initialized - Signal: Good</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <span style="font-size: 1.5rem;">‚úì</span>
        <span id="notificationText">Settings saved successfully</span>
    </div>

    <script>
        let currentPriority = 'wifi';
        let autoSwitch = true;
        let autoReconnect = true;

        // Load settings on page load
        window.onload = function() {
            loadSettings();
            load4GMode();
            updateConnectionStatus();
            setInterval(updateConnectionStatus, 2000);
        };

        function loadSettings() {
            fetch('/api/connection/settings')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        currentPriority = data.settings.priority || 'wifi';
                        autoSwitch = data.settings.auto_switch !== false;
                        autoReconnect = data.settings.auto_reconnect !== false;
                        
                        document.getElementById('priority-' + currentPriority).classList.add('active');
                        document.getElementById('autoSwitch').classList.toggle('active', autoSwitch);
                        document.getElementById('autoReconnect').classList.toggle('active', autoReconnect);
                        
                        if (data.settings.wifi_threshold) {
                            document.getElementById('wifiThreshold').value = data.settings.wifi_threshold;
                        }
                        if (data.settings.timeout) {
                            document.getElementById('timeout').value = data.settings.timeout;
                        }
                    }
                })
                .catch(err => {
                    console.log('Using default settings');
                });
        }

        function setPriority(priority) {
            currentPriority = priority;
            document.querySelectorAll('.priority-option').forEach(opt => {
                opt.classList.remove('active');
            });
            document.getElementById('priority-' + priority).classList.add('active');
            
            addLog(`Connection priority set to ${priority.toUpperCase()}`);
        }

        function toggleAutoSwitch() {
            autoSwitch = !autoSwitch;
            document.getElementById('autoSwitch').classList.toggle('active', autoSwitch);
            addLog(`Auto-switching ${autoSwitch ? 'enabled' : 'disabled'}`);
        }

        function toggleAutoReconnect() {
            autoReconnect = !autoReconnect;
            document.getElementById('autoReconnect').classList.toggle('active', autoReconnect);
            addLog(`Auto-reconnect ${autoReconnect ? 'enabled' : 'disabled'}`);
        }

        function saveSettings() {
            const settings = {
                priority: currentPriority,
                auto_switch: autoSwitch,
                auto_reconnect: autoReconnect,
                wifi_threshold: parseInt(document.getElementById('wifiThreshold').value),
                timeout: parseInt(document.getElementById('timeout').value)
            };

            fetch('/api/connection/settings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(settings)
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification('‚úì Settings saved successfully');
                        addLog('Settings saved and applied');
                    } else {
                        showNotification('‚úó Failed to save settings', true);
                    }
                })
                .catch(error => {
                    showNotification('‚úó Error: ' + error.message, true);
                });
        }

        function testConnection() {
            addLog('Testing connection...');
            showNotification('üîç Testing connection...');

            fetch('/api/connection/test')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        addLog(`Test successful - Latency: ${data.latency}ms`);
                        showNotification(`‚úì Connection OK - ${data.latency}ms`);
                    } else {
                        addLog('Test failed: ' + data.message);
                        showNotification('‚úó Connection test failed', true);
                    }
                })
                .catch(error => {
                    addLog('Test error: ' + error.message);
                    showNotification('‚úó Test error', true);
                });
        }

        function updateConnectionStatus() {
            // Get real network info from CM5
            fetch('/api/network/info')
                .then(response => response.json())
                .then(netInfo => {
                    // Update current carrier/network info
                    updateCarrierInfo(netInfo);
                    
                    // Update active connection display
                    const activeConn = document.getElementById('activeConnection');
                    activeConn.textContent = netInfo.type || 'Unknown';
                    
                    // Update server connection status
                    fetch('/api/status')
                        .then(response => response.json())
                        .then(data => {
                            const serverSignal = document.getElementById('serverSignal');
                            const serverStatus = document.getElementById('serverStatus');
                            
                            if (data.auth_status === 'Authenticated') {
                                serverSignal.style.color = 'var(--accent-green)';
                                serverSignal.textContent = '‚óè';
                                serverStatus.textContent = 'Connected - Real-time';
                            } else {
                                serverSignal.style.color = 'var(--accent-red)';
                                serverSignal.textContent = '‚óè';
                                serverStatus.textContent = 'Disconnected';
                            }
                        });
                    
                    // Update network-specific info based on actual interface
                    if (netInfo.type === 'WiFi') {
                        // Convert quality to signal bars (0-5)
                        const signalBars = Math.min(5, Math.max(1, Math.ceil(netInfo.quality / 20)));
                        updateSignalBars('wifiSignal', signalBars);
                        document.getElementById('wifiSpeed').textContent = `Speed: ${netInfo.speed}`;
                        
                        // Show 4G as inactive
                        updateSignalBars('fourGSignal', 0);
                        document.getElementById('fourGSpeed').textContent = 'Inactive';
                    } else if (netInfo.type === '4G/LTE') {
                        // Show WiFi as inactive
                        updateSignalBars('wifiSignal', 0);
                        document.getElementById('wifiSpeed').textContent = 'Inactive';
                        
                        // Convert quality to signal bars (0-5)
                        const signalBars = Math.min(5, Math.max(1, Math.ceil(netInfo.quality / 20)));
                        updateSignalBars('fourGSignal', signalBars);
                        document.getElementById('fourGSpeed').textContent = `Speed: ${netInfo.speed}`;
                    } else if (netInfo.type === 'Ethernet') {
                        // Show Ethernet info
                        updateSignalBars('wifiSignal', 5);
                        document.getElementById('wifiSpeed').textContent = `Speed: ${netInfo.speed}`;
                        updateSignalBars('fourGSignal', 0);
                        document.getElementById('fourGSpeed').textContent = 'N/A';
                    } else {
                        // Unknown/No connection
                        updateSignalBars('wifiSignal', 0);
                        updateSignalBars('fourGSignal', 0);
                        document.getElementById('wifiSpeed').textContent = 'N/A';
                        document.getElementById('fourGSpeed').textContent = 'N/A';
                    }
                })
                .catch(err => {
                    console.log('Network status update error:', err);
                    addLog('Error fetching network status');
                    // Show mock data when no server
                    updateCarrierInfoMock();
                });
        }

        function updateSignalBars(elementId, strength) {
            const bars = document.getElementById(elementId).querySelectorAll('.signal-bar');
            bars.forEach((bar, index) => {
                bar.classList.toggle('active', index < strength);
            });
        }

        function updateCarrierInfo(netInfo) {
            const carrierEl = document.getElementById('currentCarrier');
            const detailsEl = document.getElementById('carrierDetails');
            
            if (netInfo) {
                // Determine connection type
                let connectionType = 'Unknown';
                let carrierName = 'N/A';
                let connectionIcon = 'üì°';
                
                // Check WiFi
                if (netInfo.wifi_connected) {
                    connectionType = 'WiFi';
                    carrierName = netInfo.wifi_ssid || 'WiFi Network';
                    connectionIcon = 'üì∂';
                    carrierEl.style.color = 'var(--accent-green)';
                }
                // Check 4G/LTE
                else if (netInfo.modem_connected) {
                    connectionType = '4G/LTE';
                    carrierName = netInfo.carrier_name || netInfo.operator || 'Mobile Network';
                    connectionIcon = 'üì±';
                    carrierEl.style.color = 'var(--accent-yellow)';
                }
                // Check Ethernet
                else if (netInfo.ethernet_connected) {
                    connectionType = 'Ethernet';
                    carrierName = 'Wired Connection';
                    connectionIcon = 'üîå';
                    carrierEl.style.color = 'var(--accent-cyan)';
                }
                
                // Update display
                carrierEl.innerHTML = `${connectionIcon} ${carrierName}`;
                detailsEl.textContent = `Type: ${connectionType} | IP: ${netInfo.ip_address || 'N/A'}`;
                
                // Update active connection indicator
                document.getElementById('activeConnection').textContent = connectionType;
            }
        }

        function updateCarrierInfoMock() {
            // Mock data when server is not available
            const carrierEl = document.getElementById('currentCarrier');
            const detailsEl = document.getElementById('carrierDetails');
            
            // Simulate detection
            const mockCarriers = [
                { icon: 'üì∂', name: 'WiFi Home', type: 'WiFi', ip: '192.168.1.100' },
                { icon: 'üì±', name: 'Viettel 4G', type: '4G/LTE', ip: '10.x.x.x' },
                { icon: 'üì±', name: 'Vinaphone', type: '4G/LTE', ip: '10.x.x.x' },
                { icon: 'üì±', name: 'Mobifone', type: '4G/LTE', ip: '10.x.x.x' }
            ];
            
            const mock = mockCarriers[Math.floor(Math.random() * mockCarriers.length)];
            
            carrierEl.innerHTML = `${mock.icon} ${mock.name}`;
            detailsEl.textContent = `Type: ${mock.type} | IP: ${mock.ip}`;
            document.getElementById('activeConnection').textContent = mock.type;
            
            carrierEl.style.color = mock.type === 'WiFi' ? 'var(--accent-green)' : 'var(--accent-yellow)';
        }

        function addLog(message) {
            const log = document.getElementById('connectionLog');
            const now = new Date();
            const timestamp = now.toTimeString().split(' ')[0];
            
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `<span class="log-timestamp">[${timestamp}]</span><span>${message}</span>`;
            
            log.insertBefore(entry, log.firstChild);
            
            // Keep only last 10 entries
            while (log.children.length > 10) {
                log.removeChild(log.lastChild);
            }
        }

        function load4GMode() {
            fetch('/api/network/4g/mode')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('fourGMode').value = data.current_mode;
                        addLog(`4G mode: ${data.current_mode}`);
                    }
                })
                .catch(err => {
                    console.log('Cannot load 4G mode:', err);
                });
        }

        function set4GMode() {
            const mode = document.getElementById('fourGMode').value;
            addLog(`Setting 4G mode to ${mode}...`);
            showNotification(`‚è≥ Setting 4G mode to ${mode}...`);

            fetch('/api/network/4g/mode/set', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ mode: mode })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification(`‚úì 4G mode set to ${mode}`);
                        addLog(`4G mode changed to ${mode} successfully`);
                        // Reload status after 2 seconds
                        setTimeout(() => {
                            updateConnectionStatus();
                        }, 2000);
                    } else {
                        showNotification(`‚úó Failed to set 4G mode: ${data.message}`, true);
                        addLog(`Error: ${data.message}`);
                    }
                })
                .catch(error => {
                    showNotification('‚úó Error: ' + error.message, true);
                    addLog('Error setting 4G mode: ' + error.message);
                });
        }

        function showNotification(text, isError = false) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = text;
            notification.style.borderColor = isError ? 'var(--accent-red)' : 'var(--accent-green)';
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
